{"remainingRequest":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\src\\views\\PayMoney\\SuccessPayment.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\src\\views\\PayMoney\\SuccessPayment.vue","mtime":1645609201000},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664720015241},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\babel-loader\\lib\\index.js","mtime":1665053040434},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664720015241},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\vue-loader\\lib\\index.js","mtime":1664810875252}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBUb3BIZWFkZXIgZnJvbSAiQC9jb21wb25lbnRzL0NvbW1vbi9Ub3BIZWFkZXIudnVlIjsKaW1wb3J0IEZvb3RlciBmcm9tICJAL2NvbXBvbmVudHMvQ29tbW9uL0Zvb3Rlci52dWUiOwppbXBvcnQgQ2hlY2tvdXRTZXJ2aWNlIGZyb20gIkAvc2VydmljZXMvQ2hlY2tvdXRTZXJ2aWNlLmpzIjsKaW1wb3J0IE9yZGVyU2VydmljZSBmcm9tICJAL3NlcnZpY2VzL09yZGVyU2VydmljZS5qcyI7CmltcG9ydCBPcmRlckl0ZW1TZXJ2aWNlIGZyb20gIkAvc2VydmljZXMvT3JkZXJJdGVtU2VydmljZS5qcyI7CmltcG9ydCBQcm9kdWN0c1NlcnZpY2UgZnJvbSAiQC9zZXJ2aWNlcy9Qcm9kdWN0c1NlcnZpY2UuanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlN1Y2Nlc3NQYXltZW50IiwKICBjb21wb25lbnRzOiB7CiAgICBUb3BIZWFkZXIsCiAgICBGb290ZXIKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBvcmRlcjoge30sCiAgICAgIHNlc3Npb246IHt9LAogICAgICB2YWxpZFNlc3Npb246IGZhbHNlCiAgICB9OwogIH0sCiAgYXN5bmMgbW91bnRlZCgpIHsKICAgIGNvbnN0IHNlc3Npb25JZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmlkOwogICAgdmFyIHByZXZpb3VzT3JkZXI7CiAgICB0cnkgewogICAgICBwcmV2aW91c09yZGVyID0gKGF3YWl0IE9yZGVyU2VydmljZS5nZXRPcmRlckJ5U2Vzc2lvbklkKHNlc3Npb25JZCkpLmRhdGE7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmxvZyhlcnJvci5yZXNwb25zZS5kYXRhLmVycm9yKTsKICAgIH0KICAgIGlmIChwcmV2aW91c09yZGVyKSByZXR1cm47CiAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgiQ2FydC9jbGVhckNhcnQiKTsKICAgIHRyeSB7CiAgICAgIHRoaXMuc2Vzc2lvbiA9ICgKICAgICAgICBhd2FpdCBDaGVja291dFNlcnZpY2UucmV0cmlldmVDaGVja291dFNlc3Npb24oc2Vzc2lvbklkKQogICAgICApLmRhdGE7CiAgICAgIHRoaXMudmFsaWRTZXNzaW9uID0gT2JqZWN0LmtleXModGhpcy5zZXNzaW9uKS5sZW5ndGggIT0gMDsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUubG9nKGVycm9yLnJlc3BvbnNlLmRhdGEuZXJyb3IpOwogICAgfQogICAgaWYgKCF0aGlzLnZhbGlkU2Vzc2lvbikgcmV0dXJuOwogICAgY29uc3QgbGluZUl0ZW1zID0gdGhpcy5zZXNzaW9uLmxpbmVfaXRlbXMuZGF0YTsKICAgIGNvbnN0IHNoaXBDb3N0ID0gbGluZUl0ZW1zW2xpbmVJdGVtcy5sZW5ndGggLSAxXS5hbW91bnRfdG90YWw7CiAgICB0cnkgewogICAgICB0aGlzLm9yZGVyID0gKAogICAgICAgIGF3YWl0IE9yZGVyU2VydmljZS5jcmVhdGVPcmRlcih7CiAgICAgICAgICBuYW1lOiB0aGlzLnNlc3Npb24ubWV0YWRhdGEuY3VzdG9tZXJOYW1lLAogICAgICAgICAgcGhvbmVObzogdGhpcy5zZXNzaW9uLm1ldGFkYXRhLmN1c3RvbWVyUGhvbmVObywKICAgICAgICAgIGVtYWlsOiB0aGlzLnNlc3Npb24uY3VzdG9tZXJfZW1haWwsCiAgICAgICAgICBhZGRyZXNzOiB0aGlzLnNlc3Npb24ubWV0YWRhdGEuc2hpcHBpbmdBZGRyZXNzLAogICAgICAgICAgc3RhdHVzOiAicGFpZCIsCiAgICAgICAgICB2YXJpYW50OiAiZGFyayIsCiAgICAgICAgICBjaGVja291dFNlc3Npb25JZDogc2Vzc2lvbklkLAogICAgICAgICAgcHJvZHVjdENvc3Q6ICh0aGlzLnNlc3Npb24uYW1vdW50X3RvdGFsIC0gc2hpcENvc3QpIC8gMTAwLAogICAgICAgICAgY3VycmVuY3k6IHRoaXMuc2Vzc2lvbi5jdXJyZW5jeS50b1VwcGVyQ2FzZSgpLAogICAgICAgICAgc2hpcHBpbmdDb3N0OiBzaGlwQ29zdCAvIDEwMAogICAgICAgIH0pCiAgICAgICkuZGF0YTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUubG9nKGVycm9yLnJlc3BvbnNlLmRhdGEuZXJyb3IpOwogICAgfQoKICAgIHZhciBpOwogICAgZm9yIChpID0gMDsgaSA8IGxpbmVJdGVtcy5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgY29uc3QgcHJvZHVjdElkID0gcGFyc2VJbnQobGluZUl0ZW1zW2ldLmRlc2NyaXB0aW9uKTsKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCBPcmRlckl0ZW1TZXJ2aWNlLmNyZWF0ZU9yZGVySXRlbSh7CiAgICAgICAgICBxdWFudGl0eTogbGluZUl0ZW1zW2ldLnF1YW50aXR5LAogICAgICAgICAgUHJvZHVjdElkOiBwcm9kdWN0SWQsCiAgICAgICAgICBPcmRlcklkOiB0aGlzLm9yZGVyLmlkCiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IucmVzcG9uc2UuZGF0YS5lcnJvcik7CiAgICAgIH0KICAgICAgdmFyIGxpbmVwcm9kdWN0OwogICAgICB0cnkgewogICAgICAgIGxpbmVwcm9kdWN0ID0gKGF3YWl0IFByb2R1Y3RzU2VydmljZS5nZXRQcm9kdWN0U2FsZXMocHJvZHVjdElkKSkuZGF0YTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmxvZyhlcnJvci5yZXNwb25zZS5kYXRhLmVycm9yKTsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGF3YWl0IFByb2R1Y3RzU2VydmljZS51cGRhdGVQcm9kdWN0KHsKICAgICAgICAgIGlkOiBwcm9kdWN0SWQsCiAgICAgICAgICBzYWxlczogbGluZXByb2R1Y3Quc2FsZXMgKyBsaW5lSXRlbXNbaV0ucXVhbnRpdHkKICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmxvZyhlcnJvci5yZXNwb25zZS5kYXRhLmVycm9yKTsKICAgICAgfQogICAgfQogIH0sCiAgbWV0aG9kczoge30sCiAgY29tcHV0ZWQ6IHt9Cn07Cg=="},{"version":3,"sources":["SuccessPayment.vue"],"names":[],"mappings":";AA6BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SuccessPayment.vue","sourceRoot":"src/views/PayMoney","sourcesContent":["<template>\n  <div>\n    <TopHeader></TopHeader>\n    <b-container class=\"mt-5\">\n      <b-row align-h=\"center\">\n        <b-col cols=\"6\" class=\"text-center\">\n          <b-card\n            border-variant=\"primary\"\n            header=\"Payment Succeeded\"\n            header-bg-variant=\"primary\"\n            header-text-variant=\"white\"\n            align=\"center\"\n          >\n            <b-button size=\"lg\" disabled variant=\"primary\">\n              <b-icon icon=\"check\" scale=\"3\" />\n            </b-button>\n            <h1 class=\"mt-4\">You're all set!</h1>\n            <h6>Thanks for your purchase!</h6>\n            <h6>We'll deliver your order in few days.</h6>\n            <b-card-footer class=\"mt-4\"> emarket-bd.com </b-card-footer>\n          </b-card>\n        </b-col>\n      </b-row>\n    </b-container>\n    <Footer class=\"mt-5\" />\n  </div>\n</template>\n\n<script>\nimport TopHeader from \"@/components/Common/TopHeader.vue\";\nimport Footer from \"@/components/Common/Footer.vue\";\nimport CheckoutService from \"@/services/CheckoutService.js\";\nimport OrderService from \"@/services/OrderService.js\";\nimport OrderItemService from \"@/services/OrderItemService.js\";\nimport ProductsService from \"@/services/ProductsService.js\";\nexport default {\n  name: \"SuccessPayment\",\n  components: {\n    TopHeader,\n    Footer\n  },\n  data() {\n    return {\n      order: {},\n      session: {},\n      validSession: false\n    };\n  },\n  async mounted() {\n    const sessionId = this.$route.query.id;\n    var previousOrder;\n    try {\n      previousOrder = (await OrderService.getOrderBySessionId(sessionId)).data;\n    } catch (error) {\n      console.log(error.response.data.error);\n    }\n    if (previousOrder) return;\n    this.$store.dispatch(\"Cart/clearCart\");\n    try {\n      this.session = (\n        await CheckoutService.retrieveCheckoutSession(sessionId)\n      ).data;\n      this.validSession = Object.keys(this.session).length != 0;\n    } catch (error) {\n      console.log(error.response.data.error);\n    }\n    if (!this.validSession) return;\n    const lineItems = this.session.line_items.data;\n    const shipCost = lineItems[lineItems.length - 1].amount_total;\n    try {\n      this.order = (\n        await OrderService.createOrder({\n          name: this.session.metadata.customerName,\n          phoneNo: this.session.metadata.customerPhoneNo,\n          email: this.session.customer_email,\n          address: this.session.metadata.shippingAddress,\n          status: \"paid\",\n          variant: \"dark\",\n          checkoutSessionId: sessionId,\n          productCost: (this.session.amount_total - shipCost) / 100,\n          currency: this.session.currency.toUpperCase(),\n          shippingCost: shipCost / 100\n        })\n      ).data;\n    } catch (error) {\n      console.log(error.response.data.error);\n    }\n\n    var i;\n    for (i = 0; i < lineItems.length - 1; i++) {\n      const productId = parseInt(lineItems[i].description);\n      try {\n        await OrderItemService.createOrderItem({\n          quantity: lineItems[i].quantity,\n          ProductId: productId,\n          OrderId: this.order.id\n        });\n      } catch (error) {\n        console.log(error.response.data.error);\n      }\n      var lineproduct;\n      try {\n        lineproduct = (await ProductsService.getProductSales(productId)).data;\n      } catch (error) {\n        console.log(error.response.data.error);\n      }\n      try {\n        await ProductsService.updateProduct({\n          id: productId,\n          sales: lineproduct.sales + lineItems[i].quantity\n        });\n      } catch (error) {\n        console.log(error.response.data.error);\n      }\n    }\n  },\n  methods: {},\n  computed: {}\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n"]}]}