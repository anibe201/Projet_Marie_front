{"remainingRequest":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\src\\views\\PayMoney\\SuccessPayment.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\src\\views\\PayMoney\\SuccessPayment.vue","mtime":1645609201000},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\babel.config.js","mtime":1645609201000},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664810865393},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\babel-loader\\lib\\index.js","mtime":1664810865430},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664810865393},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\vue-loader\\lib\\index.js","mtime":1664810875252}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IFRvcEhlYWRlciBmcm9tICJAL2NvbXBvbmVudHMvQ29tbW9uL1RvcEhlYWRlci52dWUiOwppbXBvcnQgRm9vdGVyIGZyb20gIkAvY29tcG9uZW50cy9Db21tb24vRm9vdGVyLnZ1ZSI7CmltcG9ydCBDaGVja291dFNlcnZpY2UgZnJvbSAiQC9zZXJ2aWNlcy9DaGVja291dFNlcnZpY2UuanMiOwppbXBvcnQgT3JkZXJTZXJ2aWNlIGZyb20gIkAvc2VydmljZXMvT3JkZXJTZXJ2aWNlLmpzIjsKaW1wb3J0IE9yZGVySXRlbVNlcnZpY2UgZnJvbSAiQC9zZXJ2aWNlcy9PcmRlckl0ZW1TZXJ2aWNlLmpzIjsKaW1wb3J0IFByb2R1Y3RzU2VydmljZSBmcm9tICJAL3NlcnZpY2VzL1Byb2R1Y3RzU2VydmljZS5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiU3VjY2Vzc1BheW1lbnQiLAogIGNvbXBvbmVudHM6IHsKICAgIFRvcEhlYWRlciwKICAgIEZvb3RlcgogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG9yZGVyOiB7fSwKICAgICAgc2Vzc2lvbjoge30sCiAgICAgIHZhbGlkU2Vzc2lvbjogZmFsc2UKICAgIH07CiAgfSwKICBhc3luYyBtb3VudGVkKCkgewogICAgY29uc3Qgc2Vzc2lvbklkID0gdGhpcy4kcm91dGUucXVlcnkuaWQ7CiAgICB2YXIgcHJldmlvdXNPcmRlcjsKICAgIHRyeSB7CiAgICAgIHByZXZpb3VzT3JkZXIgPSAoYXdhaXQgT3JkZXJTZXJ2aWNlLmdldE9yZGVyQnlTZXNzaW9uSWQoc2Vzc2lvbklkKSkuZGF0YTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnNvbGUubG9nKGVycm9yLnJlc3BvbnNlLmRhdGEuZXJyb3IpOwogICAgfQogICAgaWYgKHByZXZpb3VzT3JkZXIpIHJldHVybjsKICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJDYXJ0L2NsZWFyQ2FydCIpOwogICAgdHJ5IHsKICAgICAgdGhpcy5zZXNzaW9uID0gKGF3YWl0IENoZWNrb3V0U2VydmljZS5yZXRyaWV2ZUNoZWNrb3V0U2Vzc2lvbihzZXNzaW9uSWQpKS5kYXRhOwogICAgICB0aGlzLnZhbGlkU2Vzc2lvbiA9IE9iamVjdC5rZXlzKHRoaXMuc2Vzc2lvbikubGVuZ3RoICE9IDA7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmxvZyhlcnJvci5yZXNwb25zZS5kYXRhLmVycm9yKTsKICAgIH0KICAgIGlmICghdGhpcy52YWxpZFNlc3Npb24pIHJldHVybjsKICAgIGNvbnN0IGxpbmVJdGVtcyA9IHRoaXMuc2Vzc2lvbi5saW5lX2l0ZW1zLmRhdGE7CiAgICBjb25zdCBzaGlwQ29zdCA9IGxpbmVJdGVtc1tsaW5lSXRlbXMubGVuZ3RoIC0gMV0uYW1vdW50X3RvdGFsOwogICAgdHJ5IHsKICAgICAgdGhpcy5vcmRlciA9IChhd2FpdCBPcmRlclNlcnZpY2UuY3JlYXRlT3JkZXIoewogICAgICAgIG5hbWU6IHRoaXMuc2Vzc2lvbi5tZXRhZGF0YS5jdXN0b21lck5hbWUsCiAgICAgICAgcGhvbmVObzogdGhpcy5zZXNzaW9uLm1ldGFkYXRhLmN1c3RvbWVyUGhvbmVObywKICAgICAgICBlbWFpbDogdGhpcy5zZXNzaW9uLmN1c3RvbWVyX2VtYWlsLAogICAgICAgIGFkZHJlc3M6IHRoaXMuc2Vzc2lvbi5tZXRhZGF0YS5zaGlwcGluZ0FkZHJlc3MsCiAgICAgICAgc3RhdHVzOiAicGFpZCIsCiAgICAgICAgdmFyaWFudDogImRhcmsiLAogICAgICAgIGNoZWNrb3V0U2Vzc2lvbklkOiBzZXNzaW9uSWQsCiAgICAgICAgcHJvZHVjdENvc3Q6ICh0aGlzLnNlc3Npb24uYW1vdW50X3RvdGFsIC0gc2hpcENvc3QpIC8gMTAwLAogICAgICAgIGN1cnJlbmN5OiB0aGlzLnNlc3Npb24uY3VycmVuY3kudG9VcHBlckNhc2UoKSwKICAgICAgICBzaGlwcGluZ0Nvc3Q6IHNoaXBDb3N0IC8gMTAwCiAgICAgIH0pKS5kYXRhOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc29sZS5sb2coZXJyb3IucmVzcG9uc2UuZGF0YS5lcnJvcik7CiAgICB9CiAgICB2YXIgaTsKICAgIGZvciAoaSA9IDA7IGkgPCBsaW5lSXRlbXMubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgIGNvbnN0IHByb2R1Y3RJZCA9IHBhcnNlSW50KGxpbmVJdGVtc1tpXS5kZXNjcmlwdGlvbik7CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgT3JkZXJJdGVtU2VydmljZS5jcmVhdGVPcmRlckl0ZW0oewogICAgICAgICAgcXVhbnRpdHk6IGxpbmVJdGVtc1tpXS5xdWFudGl0eSwKICAgICAgICAgIFByb2R1Y3RJZDogcHJvZHVjdElkLAogICAgICAgICAgT3JkZXJJZDogdGhpcy5vcmRlci5pZAogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUubG9nKGVycm9yLnJlc3BvbnNlLmRhdGEuZXJyb3IpOwogICAgICB9CiAgICAgIHZhciBsaW5lcHJvZHVjdDsKICAgICAgdHJ5IHsKICAgICAgICBsaW5lcHJvZHVjdCA9IChhd2FpdCBQcm9kdWN0c1NlcnZpY2UuZ2V0UHJvZHVjdFNhbGVzKHByb2R1Y3RJZCkpLmRhdGE7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IucmVzcG9uc2UuZGF0YS5lcnJvcik7CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCBQcm9kdWN0c1NlcnZpY2UudXBkYXRlUHJvZHVjdCh7CiAgICAgICAgICBpZDogcHJvZHVjdElkLAogICAgICAgICAgc2FsZXM6IGxpbmVwcm9kdWN0LnNhbGVzICsgbGluZUl0ZW1zW2ldLnF1YW50aXR5CiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IucmVzcG9uc2UuZGF0YS5lcnJvcik7CiAgICAgIH0KICAgIH0KICB9LAogIG1ldGhvZHM6IHt9LAogIGNvbXB1dGVkOiB7fQp9Ow=="},{"version":3,"mappings":"AA6BA;AACA;AACA;AACA;AACA;AACA;AACA;EACAA;EACAC;IACAC;IACAC;EACA;EACAC;IACA;MACAC;MACAC;MACAC;IACA;EACA;EACA;IACA;IACA;IACA;MACAC;IACA;MACAC;IACA;IACA;IACA;IACA;MACA,gBACA,0DACAL;MACA;IACA;MACAK;IACA;IACA;IACA;IACA;IACA;MACA,cACA;QACAT;QACAU;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA,IACAd;IACA;MACAK;IACA;IAEA;IACA;MACA;MACA;QACA;UACAU;UACAC;UACAC;QACA;MACA;QACAZ;MACA;MACA;MACA;QACAa;MACA;QACAb;MACA;MACA;QACA;UACAc;UACAC;QACA;MACA;QACAf;MACA;IACA;EACA;EACAgB;EACAC;AACA","names":["name","components","TopHeader","Footer","data","order","session","validSession","previousOrder","console","phoneNo","email","address","status","variant","checkoutSessionId","productCost","currency","shippingCost","quantity","ProductId","OrderId","lineproduct","id","sales","methods","computed"],"sourceRoot":"src/views/PayMoney","sources":["SuccessPayment.vue"],"sourcesContent":["<template>\n  <div>\n    <TopHeader></TopHeader>\n    <b-container class=\"mt-5\">\n      <b-row align-h=\"center\">\n        <b-col cols=\"6\" class=\"text-center\">\n          <b-card\n            border-variant=\"primary\"\n            header=\"Payment Succeeded\"\n            header-bg-variant=\"primary\"\n            header-text-variant=\"white\"\n            align=\"center\"\n          >\n            <b-button size=\"lg\" disabled variant=\"primary\">\n              <b-icon icon=\"check\" scale=\"3\" />\n            </b-button>\n            <h1 class=\"mt-4\">You're all set!</h1>\n            <h6>Thanks for your purchase!</h6>\n            <h6>We'll deliver your order in few days.</h6>\n            <b-card-footer class=\"mt-4\"> emarket-bd.com </b-card-footer>\n          </b-card>\n        </b-col>\n      </b-row>\n    </b-container>\n    <Footer class=\"mt-5\" />\n  </div>\n</template>\n\n<script>\nimport TopHeader from \"@/components/Common/TopHeader.vue\";\nimport Footer from \"@/components/Common/Footer.vue\";\nimport CheckoutService from \"@/services/CheckoutService.js\";\nimport OrderService from \"@/services/OrderService.js\";\nimport OrderItemService from \"@/services/OrderItemService.js\";\nimport ProductsService from \"@/services/ProductsService.js\";\nexport default {\n  name: \"SuccessPayment\",\n  components: {\n    TopHeader,\n    Footer\n  },\n  data() {\n    return {\n      order: {},\n      session: {},\n      validSession: false\n    };\n  },\n  async mounted() {\n    const sessionId = this.$route.query.id;\n    var previousOrder;\n    try {\n      previousOrder = (await OrderService.getOrderBySessionId(sessionId)).data;\n    } catch (error) {\n      console.log(error.response.data.error);\n    }\n    if (previousOrder) return;\n    this.$store.dispatch(\"Cart/clearCart\");\n    try {\n      this.session = (\n        await CheckoutService.retrieveCheckoutSession(sessionId)\n      ).data;\n      this.validSession = Object.keys(this.session).length != 0;\n    } catch (error) {\n      console.log(error.response.data.error);\n    }\n    if (!this.validSession) return;\n    const lineItems = this.session.line_items.data;\n    const shipCost = lineItems[lineItems.length - 1].amount_total;\n    try {\n      this.order = (\n        await OrderService.createOrder({\n          name: this.session.metadata.customerName,\n          phoneNo: this.session.metadata.customerPhoneNo,\n          email: this.session.customer_email,\n          address: this.session.metadata.shippingAddress,\n          status: \"paid\",\n          variant: \"dark\",\n          checkoutSessionId: sessionId,\n          productCost: (this.session.amount_total - shipCost) / 100,\n          currency: this.session.currency.toUpperCase(),\n          shippingCost: shipCost / 100\n        })\n      ).data;\n    } catch (error) {\n      console.log(error.response.data.error);\n    }\n\n    var i;\n    for (i = 0; i < lineItems.length - 1; i++) {\n      const productId = parseInt(lineItems[i].description);\n      try {\n        await OrderItemService.createOrderItem({\n          quantity: lineItems[i].quantity,\n          ProductId: productId,\n          OrderId: this.order.id\n        });\n      } catch (error) {\n        console.log(error.response.data.error);\n      }\n      var lineproduct;\n      try {\n        lineproduct = (await ProductsService.getProductSales(productId)).data;\n      } catch (error) {\n        console.log(error.response.data.error);\n      }\n      try {\n        await ProductsService.updateProduct({\n          id: productId,\n          sales: lineproduct.sales + lineItems[i].quantity\n        });\n      } catch (error) {\n        console.log(error.response.data.error);\n      }\n    }\n  },\n  methods: {},\n  computed: {}\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n"]}]}