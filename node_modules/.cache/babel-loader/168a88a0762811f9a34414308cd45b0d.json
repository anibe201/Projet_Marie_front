{"remainingRequest":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\src\\components\\User\\Profile\\UAccount.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\src\\components\\User\\Profile\\UAccount.vue","mtime":1645609201000},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\babel.config.js","mtime":1645609201000},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664720015241},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\babel-loader\\lib\\index.js","mtime":1665053040434},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664720015241},{"path":"C:\\Users\\AlexisAnohVianneyANI\\Downloads\\emarket-main\\shop\\node_modules\\vue-loader\\lib\\index.js","mtime":1665053078023}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCBBdXRoZW50aWNhdGlvblNlcnZpY2UgZnJvbSAiQC9zZXJ2aWNlcy9BdXRoZW50aWNhdGlvblNlcnZpY2UuanMiOwppbXBvcnQgVXNlclNlcnZpY2UgZnJvbSAiQC9zZXJ2aWNlcy9Vc2VyU2VydmljZS5qcyI7CmltcG9ydCBSZXZpZXdTZXJ2aWNlIGZyb20gIkAvc2VydmljZXMvUmV2aWV3U2VydmljZS5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiVUFjY291bnQiLAogIGNvbXBvbmVudHM6IHt9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB1c2VySWQ6IDAsCiAgICAgIHVzZXI6IHt9LAogICAgICBhZG1pbjogZmFsc2UsCiAgICAgIG1vZGFsQWxlcnQ6IG51bGwsCiAgICAgIGRlbGV0ZUFjY291bnRFcnJvcjogIiIsCiAgICAgIGN1cnJlbnRQYXNzd29yZDogbnVsbAogICAgfTsKICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLnVzZXJJZCA9IHRoaXMuJHN0b3JlLnN0YXRlLkN1cnJlbnRVc2VyLnVzZXJJZDsKICAgIHRoaXMudXNlciA9IHRoaXMuJHN0b3JlLnN0YXRlLkN1cnJlbnRVc2VyLnVzZXI7CiAgICB0aGlzLmFkbWluID0gdGhpcy4kc3RvcmUuc3RhdGUuQ3VycmVudFVzZXIuYWRtaW47CiAgfSwKICBtZXRob2RzOiB7CiAgICBmb2N1c1Bhc3N3b3JkRmllbGQoKSB7CiAgICAgIHRoaXMuJHJlZnMucGFzc3dvcmRGaWVsZC5mb2N1cygpOwogICAgfSwKICAgIGFzeW5jIGRlbGV0ZUFjY291bnQoKSB7CiAgICAgIHZhciBjb3JyZWN0UGFzc3dvcmQgPSBmYWxzZTsKICAgICAgdHJ5IHsKICAgICAgICBjb3JyZWN0UGFzc3dvcmQgPSAoYXdhaXQgQXV0aGVudGljYXRpb25TZXJ2aWNlLnZlcmlmeVBhc3N3b3JkKHRoaXMuY3VycmVudFBhc3N3b3JkKSkuZGF0YS5jb3JyZWN0UGFzc3dvcmQ7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgdGhpcy5tb2RhbEFsZXJ0ID0gdHJ1ZTsKICAgICAgICB0aGlzLmRlbGV0ZUFjY291bnRFcnJvciA9IGVycm9yLnJlc3BvbnNlLmRhdGEuZXJyb3I7CiAgICAgICAgY29uc29sZS5sb2coZXJyb3IucmVzcG9uc2UuZGF0YS5lcnJvcik7CiAgICAgIH0KICAgICAgaWYgKGNvcnJlY3RQYXNzd29yZCkgewogICAgICAgIHZhciByZXZpZXdMaXN0ID0gW107CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldmlld0xpc3QgPSAoYXdhaXQgUmV2aWV3U2VydmljZS5nZXRVc2Vyc1Jldmlld0xpc3QodGhpcy51c2VySWQpKS5kYXRhOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvci5yZXNwb25zZS5kYXRhLmVycm9yKTsKICAgICAgICB9CiAgICAgICAgdmFyIGk7CiAgICAgICAgZm9yIChpIGluIHJldmlld0xpc3QpIHsKICAgICAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJSZXZpZXcvZGVsZXRlUmV2aWV3IiwgcmV2aWV3TGlzdFtpXSk7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICBhd2FpdCBVc2VyU2VydmljZS5kZWxldGVBY2NvdW50KHRoaXMudXNlcklkKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgdGhpcy5tb2RhbEFsZXJ0ID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuZGVsZXRlQWNjb3VudEVycm9yID0gZXJyb3IucmVzcG9uc2UuZGF0YS5lcnJvcjsKICAgICAgICB9CiAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goIkN1cnJlbnRVc2VyL3NldFRva2VuIiwgIiIpOwogICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJDdXJyZW50VXNlci9zZXRVc2VyIiwge30pOwogICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJXaXNobGlzdC9jbGVhcldpc2hsaXN0Iik7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgcGF0aDogIi8iCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LAogIGNvbXB1dGVkOiB7fQp9Ow=="},{"version":3,"mappings":";AA8EA;AACA;AACA;AACA;EACAA;EACAC;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;IACA;IACA;EACA;EACAC;IACAC;MACA;IACA;IACA;MACA;MACA;QACAC,mBACA,kEACAV;MACA;QACA;QACA;QACAW;MACA;MACA;QACA;QACA;UACAC,mEACAZ;QACA;UACAW;QACA;QACA;QACA;UACA;QACA;QACA;UACA;QACA;UACA;UACA;QACA;QACA;QACA;QACA;QACA;UAAAE;QAAA;MACA;IACA;EACA;EACAC;AACA","names":["name","components","data","userId","user","admin","modalAlert","deleteAccountError","currentPassword","mounted","methods","focusPasswordField","correctPassword","console","reviewList","path","computed"],"sourceRoot":"src/components/User/Profile","sources":["UAccount.vue"],"sourcesContent":["<template>\n  <div>\n    <b-row>\n      <b-col>\n        <h5>Account</h5>\n        <hr />\n      </b-col>\n    </b-row>\n    <div>\n      <div v-if=\"admin\">\n        Role\n        <br />\n        <b-button class=\"mt-2\" :variant=\"user.variant\">\n          {{ user.userType }}\n        </b-button>\n        <hr />\n      </div>\n      <div>\n        <b-button\n          v-b-modal.delete-account-confirmation\n          variant=\"outline-danger\"\n        >\n          Close my account\n        </b-button>\n        <br />\n        <p class=\"mt-2\">\n          Once you delete your account, you'll not be able to revert it.\n        </p>\n      </div>\n    </div>\n    <b-modal\n      @shown=\"focusPasswordField\"\n      hide-footer\n      id=\"delete-account-confirmation\"\n    >\n      <template #modal-title>\n        Are you sure you want to do this?\n      </template>\n      <p>\n        We'll also delete all of your activity from our server.\n      </p>\n\n      <label for=\"input-password\">\n        To be sure please enter your\n        <strong>current password</strong>\n      </label>\n      <b-form-input\n        type=\"password\"\n        @keyup=\"modalAlert = false\"\n        ref=\"passwordField\"\n        v-model=\"currentPassword\"\n        id=\"input-password\"\n      />\n      <b-alert :show=\"modalAlert\" variant=\"primary\" class=\"my-2 p-1 pl-2\">\n        {{ deleteAccountError }}\n      </b-alert>\n      <b-row class=\"mt-3\">\n        <b-col cols=\"4\" />\n        <b-col cols=\"4\">\n          <b-button\n            @click=\"$bvModal.hide('delete-account-confirmation')\"\n            block\n            variant=\"warning\"\n          >\n            Cancel\n          </b-button>\n        </b-col>\n        <b-col cols=\"4\">\n          <b-button block @click=\"deleteAccount\" variant=\"danger\">\n            Delete Account\n          </b-button>\n        </b-col>\n      </b-row>\n    </b-modal>\n  </div>\n</template>\n\n<script>\nimport AuthenticationService from \"@/services/AuthenticationService.js\";\nimport UserService from \"@/services/UserService.js\";\nimport ReviewService from \"@/services/ReviewService.js\";\nexport default {\n  name: \"UAccount\",\n  components: {},\n  data() {\n    return {\n      userId: 0,\n      user: {},\n      admin: false,\n      modalAlert: null,\n      deleteAccountError: \"\",\n      currentPassword: null\n    };\n  },\n  mounted() {\n    this.userId = this.$store.state.CurrentUser.userId;\n    this.user = this.$store.state.CurrentUser.user;\n    this.admin = this.$store.state.CurrentUser.admin;\n  },\n  methods: {\n    focusPasswordField() {\n      this.$refs.passwordField.focus();\n    },\n    async deleteAccount() {\n      var correctPassword = false;\n      try {\n        correctPassword = (\n          await AuthenticationService.verifyPassword(this.currentPassword)\n        ).data.correctPassword;\n      } catch (error) {\n        this.modalAlert = true;\n        this.deleteAccountError = error.response.data.error;\n        console.log(error.response.data.error);\n      }\n      if (correctPassword) {\n        var reviewList = [];\n        try {\n          reviewList = (await ReviewService.getUsersReviewList(this.userId))\n            .data;\n        } catch (error) {\n          console.log(error.response.data.error);\n        }\n        var i;\n        for (i in reviewList) {\n          await this.$store.dispatch(\"Review/deleteReview\", reviewList[i]);\n        }\n        try {\n          await UserService.deleteAccount(this.userId);\n        } catch (error) {\n          this.modalAlert = true;\n          this.deleteAccountError = error.response.data.error;\n        }\n        this.$store.dispatch(\"CurrentUser/setToken\", \"\");\n        this.$store.dispatch(\"CurrentUser/setUser\", {});\n        this.$store.dispatch(\"Wishlist/clearWishlist\");\n        this.$router.push({ path: \"/\" });\n      }\n    }\n  },\n  computed: {}\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n"]}]}